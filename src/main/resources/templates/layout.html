<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout">
<head>
    <title layout:title-pattern="$DECORATOR_TITLE - $CONTENT_TITLE">Management</title>
	<meta charset="utf-8" />
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}" href="../../css/bootstrap.min.css" />
    <link rel="stylesheet" th:href="@{/css/common.css}" />
</head>
<body>
	<h1 layout:fragment="header">Layout</h1>
	<div layout:fragment="breadcrumb"></div>
	<div layout:fragment="content">Fake content</div>
	<div><input id="text" type="text" /><button onclick="send()">发送</button></div>
	<div id="message">实时消息展示</div>
</body>
<script type="text/javascript" th:src="@{/js/jquery-1.11.0.min.js}" ></script>
<script type="text/javascript" th:src="@{/js/bootstrap.min.js}" ></script>
<!-- form -->
<script type="text/javascript" th:src="@{/js/jquery-validate/jquery.validate.js}" ></script>
<script type="text/javascript" th:src="@{/js/jquery.form.min.js}" ></script>
<!-- pagination -->
<script type="text/javascript" th:src="@{/js/jquery.twbsPagination.js}" ></script>
<script type="text/javascript">  
    var websocket = null;  
  
    //判断当前浏览器是否支持WebSocket  
    if ('WebSocket' in window) {  
        websocket = new WebSocket("ws://localhost:8080/messageSocket");  
    }  
    else {  
        alert('Not support websocket')  
    }  
  
    //连接发生错误的回调方法  
    websocket.onerror = function () {  
        setMessageInnerHTML("error");  
    };  
  
    //连接成功建立的回调方法  
    websocket.onopen = function (event) {  
        setMessageInnerHTML("open");  
    }  
  
    //接收到消息的回调方法  
    websocket.onmessage = function (event) {  
        setMessageInnerHTML(event.data);  
    }  
  
    //连接关闭的回调方法  
    websocket.onclose = function () {  
        setMessageInnerHTML("close");  
    }  
  
    //监听窗口关闭事件，当窗口关闭时，主动去关闭websocket连接，防止连接还没断开就关闭窗口，server端会抛异常。  
    window.onbeforeunload = function () {  
        websocket.close();  
    }  
  
    //将消息显示在网页上  
    function setMessageInnerHTML(innerHTML) {  
        document.getElementById('message').innerHTML += innerHTML + '<br/>';  
    }  
  
    //关闭连接  
    function closeWebSocket() {  
        websocket.close();  
    }  
  
    //发送消息  
    function send() {  
        var message = document.getElementById('text').value;  
        websocket.send(message);  
    }  
</script>
<script type="text/javascript">
$(function(){
	// Restful Delete
	$('a[data-method]').click(function(event){
		event.preventDefault();
		
		var url = $(this).attr('data-href');
		var http_verb = $(this).attr('data-method');
		var csrf = '<input type="hidden" name="_csrf" th:value="${_csrf.token}"/>';
		$('<form action="'+ url +'" method="POST"><input type="hidden" name="_method" value="'+ http_verb +'" />'+ csrf +'</form>').submit();
	});
});
</script>
<th:block layout:fragment="javascript_block"></th:block>
</html>